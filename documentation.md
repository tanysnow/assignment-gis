SLESARIKOVA TATIANA
# Úvod
Aplikácia ponúka zobrazenie rôznych artefaktov na mape v oblasti Vysokých Tatier. Najdôležitejšie features sú:
- zobrazenie vybratých miest (požičovňa lyží, bary, lekárne, ...) vzhľadom na aktuálnu pozíciu
- vybratie si rozsahu hľadania miest na základe počtu m a km od aktuálnej pozície
- nasimulovanie aktuálnej pozície
- zobrazenie top najbližšieho ubytovania podľa určeného limitu zobrazených ubytovaní a aktuálnej pozície
- zobrazenie cyklotrás spolu s bodmi, ktoré tieto cesty pretínajú
- zobrazenie väčších plôch s kultúrnymi atrakciami, ktoré sa tam nachádzajú 

Takto vyzerá aplikácia v chode:

![Screenshot](screenshot.png)
![Screenshot](screen.png)
![Screenshot](screen2.png)
![Screenshot](screen1.png)
![Screenshot](screen3.png)

Aplikácia je rozdelená na 2 časti - frontend, ktorý využíva Leaflet na zobrazovanie mapy a backend, ktorý je napísaný v Pythone spolu s frameworkom Flask. 

# Frontend
Frontend je vytvorený pomocou dvoch statických HTML stránok ('index.html' a 'polygons.html'). Mapa je zobrazovaná pomocou knižnice leaflet. Zobrazuje oblasť Vysokých Tatier spolu s vrcholmi pohorí, riekami, mestami a cestami medzi nimi. Ubytovanie sa zvýrazňuje pomocou žlej farby, cesty sú zobrazované pomocou červenej farby. Markery sú použité ako obrázky vložené do HTML kódu. Aktuálna pozícia je zobrazovaná pomocou obrázku čierneho turistu. Okruh okolo turistu je zobrazovaný modrofialovým kruhom. V tomto prípade bola ponechaná defaultná farba. V hornej časti aplikácie sa nachádza menu, kde môže používateľ selectovať artefakty, alebo vybrať iné zobrazenia.

# Backend

Backendová časť aplikácie je napísaná v jazyku Python v spolupráci s frameworkom Flask. Na prácu s databázou je využívaná knižnica [psycopg](http://initd.org/psycopg/docs/index.html). Python a Flask rieši aj spracovanie dát a formátovanie údajov.

## Dáta

Dáta sú stiahnuté priamo z Open Street Maps. Stiahnutá je časť Vysokých Tatier ako na Slovensku tak aj v Poľsku a importovaná je pomocou 'osm2pgsql' a návodu na githube. Pre zrýchlenie dopytov som vytvorila indexy - way (v tabuľke planet_osm_line a planet_osm_point), bicycle (tabuľka planet_osm_point) a amenity (tabuľka planet_osm_point). Všetky dopyty sú tvorené pomocou psycpg.cursor("dopyt").

##Query
1. scenár - zobrazenie vybratých miest (požičovňa lyží, bary, lekárne, ...) vzhľadom na aktuálnu pozíciu
```postgres
SELECT body.name, ST_AsText(body.cesta)
FROM(
	SELECT name, ST_Transform (way, 4326) as cesta 
	FROM planet_osm_point 
	WHERE amenity='parking')  as body
WHERE ST_Distance_Sphere(ST_setSRID(ST_MakePoint(20.2096027, 49.1390668), 4326), body.cesta) < 10000
```

2. scenár - zobrazenie top najbližšieho ubytovania podľa určeného limitu zobrazených ubytovaní a aktuálnej pozície
```postgres
SELECT polygons.coordinaty, polygons.cesta, polygons.name FROM (
SELECT ST_AsText (ST_Transform (way, 4326)) AS coordinaty, name, tourism, 
  		ST_Distance_Sphere(ST_setSRID(ST_MakePoint(20.2096027, 49.1390668), 4326), 
  		ST_Transform(ST_Centroid(way), 4326))  AS cesta
FROM planet_osm_polygon
WHERE tourism!='null') AS polygons
ORDER BY polygons.cesta
LIMIT 10
```

3. scenár - zobrazenie cyklotrás spolu s bodmi, ktoré tieto cesty pretínajú
```postgres
SELECT points.name, lines.name, ST_Intersects(ST_Transform(points.way, 4326), ST_Transform(lines.way, 4326)), 
       ST_AsText(ST_Transform(points.way, 4326)), ST_AsText(ST_Transform(lines.way, 4326)) 
FROM planet_osm_line as lines 
INNER JOIN planet_osm_point AS points ON (lines.bicycle = points.bicycle)
WHERE lines.bicycle='yes' and ST_Intersects(ST_Transform(points.way, 4326), ST_Transform(lines.way, 4326))='true'
```
4. scenár - zobrazenie väčších plôch s kultúrnymi atrakciami, ktoré sa tam nachádzajú
```postgres
SELECT polygon.name, ST_AsText(ST_Transform(polygon.way, 4326)), points.name,
		ST_AsText(St_Transform(points.way, 4326)), ST_Contains(polygon.way, points.way)
FROM planet_osm_polygon AS polygon
INNER JOIN planet_osm_point AS points ON (polygon.amenity = points.amenity)
```
WHERE ST_Contains(polygon.way, points.way)='true'

##Indexy
Na základe dopytov a dĺžky trvania vyhodnotenia som vytvorila takéto indexy:

```postgres
CREATE INDEX planet_osm_point_way ON planet_osm_point USING gist (way)
CREATE INDEX planet_osm_point_amenity ON planet_osm_point USING gist (amenity)

CREATE INDEX planet_osm_line_way ON planet_osm_line USING gist (way)
CREATE INDEX planet_osm_line_bicycle ON planet_osm_line USING gist (bicycle)
```

#API

zobrazenie väčších plôch s kultúrnymi atrakciami, ktoré sa tam nachádzajú
```
GET http://127.0.0.1:5000/searchAtraction
```
response

```json
["contains", [
	[
		"Panny M\u00e1rie", 
		"POLYGON((19.8019603 49.1081669996656,19.8019683 49.1081661996656,19.8019704 49.1081741996656,19.8020468 49.1081684996656,19.8020345 49.1080969996656,19.8021448 49.1080871996656,19.8021574 49.1081585996656,19.8022257 49.1081524996656,19.8022372 49.1081417996656,19.8022444 49.1081442996656,19.8022321 49.1081561996656,19.8022457 49.1081995996656,19.8022964 49.1081926996656,19.8022923 49.1081801996656,19.802301 49.1081794996656,19.8023045 49.1081907996656,19.8023585 49.1081829996656,19.8023632 49.1081719996656,19.8023713 49.1081733996656,19.8023663 49.1081844996656,19.8023989 49.1081993996656,19.8024136 49.1081932996656,19.8024188 49.1081979996656,19.802403 49.1082051996656,19.8024121 49.1082291996656,19.8024297 49.1082299996656,19.8024287 49.1082355996656,19.8024112 49.1082348996656,19.8023907 49.1082598996656,19.8024032 49.1082683996656,19.8023963 49.1082725996656,19.8023815 49.1082617996656,19.8023546 49.1082650996655,19.8023865 49.1083092996655,19.8023745 49.1083144996655,19.8023686 49.1083050996655,19.80231 49.1083228996655,19.8023166 49.1083321996655,19.802304 49.1083361996655,19.802273 49.1082930996655,19.8022609 49.1082959996656,19.8022577 49.1082879996655,19.8022278 49.1082922996656,19.8022443 49.1083391996656,19.8022352 49.1083409996655,19.8022183 49.1082941996656,19.8021917 49.1082974996656,19.8021941 49.1083054996656,19.8021741 49.1083079996655,19.8021724 49.1083000996655,19.8021154 49.1083053996655,19.8021172 49.1083122996655,19.8020947 49.1083146996655,19.8020936 49.1083078996655,19.8020362 49.1083132996655,19.8020364 49.1083189996655,19.8020111 49.1083201996655,19.8020147 49.1083304996655,19.8020004 49.1083332996655,19.8019603 49.1081669996656))", 
		"Panny M\u00e1rie", 
		"POINT(19.802143 49.1082399996656)", 
		"True"
	], 
	[
		"Zesp\u00f3\u0142 Pa\u0144stwowych Szk\u00f3\u0142 Artystycznych", 
		"POLYGON((19.9601148 49.2958886996194,19.9601591 49.2958577996194,19.9602227 49.2957884996194,19.9603681 49.2956481996194,19.9606895 49.2958314996194,19.9603485 49.2960808996193,19.9602239 49.2960131996193,19.9601815 49.2959838996194,19.9601633 49.2959292996194,19.9601148 49.2958886996194))", 
		"Pa\u0144stwowa Szko\u0142a Muzyczna I st. im. Mieczys\u0142awa Kar\u0142owicza", 
		"POINT(19.960373 49.2959358996194)", 
		"True"
	], 
	[
		"Zesp\u00f3\u0142 Pa\u0144stwowych Szk\u00f3\u0142 Artystycznych", 
		"POLYGON((19.9601148 49.2958886996194,19.9601591 49.2958577996194,19.9602227 49.2957884996194,19.9603681 49.2956481996194,19.9606895 49.2958314996194,19.9603485 49.2960808996193,19.9602239 49.2960131996193,19.9601815 49.2959838996194,19.9601633 49.2959292996194,19.9601148 49.2958886996194))", 
		"Pa\u0144stwowa Og\u00f3lnokszta\u0142c\u0105ca Szko\u0142a Artystyczna", 
		"POINT(19.9604671 49.2958250996194)", 
		"True"
	], 
	[
		"Zvestovania P\u00e1na", 
		"POLYGON((20.2667867 49.1223006996621,20.2667899 49.1222884996621,20.2668266 49.1222921996621,20.2668673 49.1222835996621,20.2668568 49.1222652996621,20.266905 49.1222524996621,20.2668881 49.1222246996621,20.2669268 49.1222149996621,20.2669437 49.1222426996621,20.2670251 49.1222210996621,20.26703 49.1222302996621,20.2671088 49.1222097996621,20.2671598 49.1222894996621,20.2670682 49.1223117996621,20.2670604 49.1222990996621,20.2669057 49.1223402996621,20.266896 49.1223240996621,20.2668521 49.1223359996621,20.2668408 49.1223501996621,20.2668278 49.1223461996621,20.266838 49.1223297996621,20.2668209 49.1223032996621,20.2667867 49.1223006996621))", 
		"nothing", 
		"POINT(20.2670777 49.1222663996621)", 
		"True"
	], 
	[
		"Klasztor Albertynek na Kalat\u00f3wkach", 
		"POLYGON((19.974622 49.2639719996272,19.9748754 49.2638884996272,19.9748884 49.2639052996272,19.9749646 49.2638802996272,19.9748332 49.2637094996273,19.9748055 49.2637185996273,19.9747384 49.2636315996273,19.9747645 49.2636229996273,19.9747423 49.2635941996273,19.9749425 49.2635281996273,19.9749595 49.2635500996273,19.9749903 49.2635398996273,19.975094 49.2636746996273,19.9749448 49.2637238996273,19.9750626 49.2638799996272,19.9751263 49.2638589996272,19.9751646 49.2639086996272,19.9749866 49.2639672996272,19.9749574 49.2639291996272,19.9746636 49.2640259996272,19.974622 49.2639719996272))", 
		"Kaplica Ku\u017anice", 
		"POINT(19.9748244 49.2639289996272)", 
		"True"
	]
]
]
```
zobrazenie väčších plôch s kultúrnymi atrakciami, ktoré sa tam nachádzajú
```
GET http://127.0.0.1:5000/searchRoads
```
response
```json
["contains", [["Hrebienok", "POINT(20.2249445 49.1588173996531)", "nothing", "LINESTRING(20.2230474 49.1497316996553,20.2231746 49.1498117996553,20.2233432 49.1498620996553,20.2236398 49.1499483996553,20.2239457 49.1500279996553,20.2242897 49.1501461996552,20.2244072 49.1502167996552,20.2244338 49.1502327996552,20.2245383 49.1503359996552,20.2246204 49.1504672996552,20.2246836 49.1505768996551,20.224705 49.1506931996551,20.2247006 49.150927999655,20.2246907 49.151138799655,20.2247142 49.151229699655,20.2247918 49.1513093996549,20.2249428 49.1514174996549,20.2251791 49.1515873996549,20.2253659 49.1517199996548,20.2255964 49.1519382996548,20.225839 49.1522759996547,20.2259924 49.1525591996546,20.2261319 49.1528730996545,20.2261812 49.1530009996545,20.2261749 49.1530878996545,20.2261617 49.1531748996545,20.2259815 49.1534485996544,20.2257225 49.1537982996543,20.2255985 49.1539243996543,20.2254201 49.1540442996543,20.2251532 49.1541852996542,20.2245999 49.1544054996542,20.2245198 49.1544391996541,20.2242271 49.1545623996541,20.2240474 49.1546418996541,20.2239119 49.1547043996541,20.2238597 49.1547823996541,20.2238704 49.154859799654,20.2239328 49.154920199654,20.2240533 49.154996899654,20.2241728 49.155088599654,20.2242786 49.155182399654,20.2243892 49.155297899654,20.2245424 49.1554973996539,20.2246804 49.1557169996539,20.22477 49.1558233996538,20.2249246 49.1559542996538,20.2252021 49.1561702996537,20.2255209 49.1564511996537,20.2256633 49.1565878996536,20.225724 49.1566688996536,20.2257837 49.1567744996536,20.2258555 49.1569679996535,20.2259223 49.1571718996535,20.2259841 49.1573995996534,20.2260377 49.1575940996534,20.2260578 49.1576852996534,20.2261172 49.1577663996533,20.2262418 49.1578916996533,20.2263328 49.1579429996533,20.2264253 49.1579883996533,20.226558 49.1580111996533,20.2267052 49.1580220996533,20.2268602 49.1580138996533,20.2270514 49.1579879996533,20.2272412 49.1579458996533,20.2275028 49.1578539996533,20.2275603 49.1578454996533,20.2276176 49.1578487996533,20.227674 49.1578885996533,20.2276849 49.1579446996533,20.2276611 49.1580242996533,20.2276228 49.1580795996533,20.2275583 49.1581241996532,20.2274345 49.1581600996532,20.2273097 49.1581832996532,20.2268785 49.1582683996532,20.2264117 49.1583744996532,20.2259786 49.1584956996532,20.2256392 49.1586058996531,20.2251962 49.1587204996531,20.2249445 49.1588173996531)", "True"], ["Hrebienok", "POINT(20.2249445 49.1588173996531)", "nothing", "LINESTRING(20.2170368 49.1675349996509,20.217034 49.167409799651,20.2172853 49.167177799651,20.2174983 49.1668028996511,20.2175602 49.1666718996511,20.2177287 49.1664678996512,20.2179903 49.1662064996513,20.2182402 49.1660727996513,20.2185262 49.1659399996513,20.2187798 49.1657181996514,20.2189052 49.1655092996514,20.2189869 49.1653773996515,20.219058 49.1653161996515,20.219327 49.1650846996515,20.2196157 49.1648000996516,20.2197501 49.1645874996517,20.2197942 49.1644137996517,20.2197302 49.1640640996518,20.2197215 49.1639075996518,20.2197571 49.1637313996519,20.2198701 49.1634863996519,20.2200684 49.163334599652,20.2201397 49.163070999652,20.2204448 49.1628271996521,20.2208295 49.1626368996521,20.2211751 49.1624546996522,20.221339 49.1622745996522,20.221612 49.1621110996523,20.2218615 49.1618844996523,20.2221323 49.1616618996524,20.222543 49.1614666996524,20.2227315 49.1612818996525,20.2230405 49.1608908996526,20.2232722 49.1606980996526,20.2235395 49.1602490996527,20.2236585 49.1599967996528,20.2237644 49.1597708996528,20.2238174 49.1595958996529,20.2239983 49.159367199653,20.2241293 49.159267399653,20.2242798 49.159226799653,20.2244141 49.159153099653,20.2245042 49.159117899653,20.2246094 49.159111499653,20.224683 49.159078799653,20.2247759 49.158982599653,20.2249303 49.1588312996531,20.2249445 49.1588173996531,20.2246312 49.1587478996531,20.2242877 49.1587257996531,20.2239888 49.1587261996531,20.2237326 49.1586984996531,20.2235397 49.1586520996531,20.2234144 49.1586119996531,20.2230336 49.1584570996532)", "True"]]]
```
